// server.js

// BASE SETUP
// =============================================================================

// call the packages we need
var express    = require('express');        // call express
var app        = express();                 // define our app using express
var bodyParser = require('body-parser');
var net        = require('net');

// configure app to use bodyParser()
// this will let us get the data from a POST
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());

var GC_SERVER_HOST = '192.168.1.50';
var GC_SERVER_PORT = 4998;

// Element TV IR codes
var elementMute = '1,38000,1,69,342,171,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,64,21,64,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,1517,342,86,21,3654';
var elementPower = '1,38000,1,69,342,171,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,64,21,21,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,64,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,1517,342,85,21,3654';
var elementVolumeUp = '1,38000,1,69,341,172,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,64,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,21,21,64,21,21,21,64,21,64,21,64,21,64,21,64,21,64,21,1518,341,86,21,3654';
var elementVolumeDown = '1,38000,1,69,341,172,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,64,21,64,21,64,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,64,21,64,21,64,21,64,21,1518,341,86,21,3654';
var elementInputScroll = '1,38000,1,69,342,170,20,20,20,64,20,20,20,20,20,20,20,20,20,20,20,20,20,64,20,20,20,64,20,64,20,64,20,64,20,64,20,20,20,64,20,64,20,20,20,64,20,20,20,20,20,64,20,20,20,20,20,20,20,64,20,20,20,64,20,64,20,20,20,64,20,1558,342,85,20,3650';

// Xbox One IR codes
var xboxBack = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxChannelDown = '1,38000,1,69,341,171,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,64,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,64,21,21,21,21,21,64,21,21,21,21,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,64,21,1655,341,85,21,3652';
var xboxChannelUp = '1,38000,1,69,341,171,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,63,21,21,21,21,21,21,21,63,21,63,21,21,21,63,21,63,21,21,21,63,21,21,21,21,21,63,21,21,21,21,21,21,21,63,21,21,21,63,21,63,21,21,21,63,21,63,21,63,21,1655,341,85,21,3652';
var xboxCursorDown = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxCursorEnter = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxCursorLeft = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,65,21,65,21,65,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxCursorRight = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxCursorUp = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit0 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit1 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit2 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit3 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit4 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit5 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit6 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit7 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit8 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxDigit9 = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,65,21,22,21,22,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxEnter = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxExit = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxForward = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxFunctionBlue = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxFunctionGreen = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,65,21,22,21,65,21,22,21,22,21,65,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxFunctionRed = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,22,21,22,21,65,21,65,21,22,21,22,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxFunctionYellow = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,22,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxMenuHome = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxMenuMain = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxMuteToggle = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxNext = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,65,21,22,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxNexusXbox = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxOneGuide = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxOpenClose = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,65,21,22,21,22,21,65,21,65,21,65,21,22,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxPause = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,22,21,22,21,65,21,65,21,65,21,22,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxPlay = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxPlayPauseToggle = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxPowerOff = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,65,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxPowerOn = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,22,21,65,21,22,21,65,21,22,21,22,21,65,21,22,21,65,21,22,21,65,21,22,21,65,21,65,21,1673,343,86,21,3732';
var xboxPowerToggle = '1,38000,1,69,342,171,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,64,21,21,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,21,21,21,21,64,21,21,21,21,21,64,21,64,21,21,21,64,21,64,21,21,21,64,21,64,21,21,21,21,21,64,21,1660,342,85,21,3662';
var xboxPrevious = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxReverse = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,22,21,65,21,22,21,22,21,22,21,22,21,65,21,22,21,65,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxStop = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,22,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxView = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,65,21,65,21,22,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,65,21,1673,343,86,21,3732';
var xboxVolumeDown = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,65,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,22,21,65,21,65,21,65,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';
var xboxVolumeUp = '1,38000,1,69,343,172,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,22,21,65,21,65,21,22,21,22,21,22,21,22,21,65,21,22,21,22,21,22,21,65,21,65,21,65,21,65,21,22,21,65,21,65,21,65,21,1673,343,86,21,3732';

var port = process.env.PORT || 8080;        // set our port

// ROUTES FOR OUR API
// =============================================================================
var router = express.Router();              // get an instance of the express Router

// middleware to use for all requests
router.use(function(req, res, next) {
    // do logging
    //console.log('Something is happening.');
    next(); // make sure we go to the next routes and don't stop here
});

// test route to make sure everything is working (accessed at GET http://localhost:8080/api)
router.get('/', function(req, res) {
    res.json({ message: 'hooray! welcome to our api!' });
});

// more routes for our API will happen here
router.route('/element/:id/:command')
    .post(function(req, res) {
      switch(req.params.id) {
        case 'bottom':
          var connectorAddress = '4:2';
          break;
        case 'top':
          var connectorAddress = '4:1';
          break;
      }

      switch (req.params.command) {
        case 'mute':
          var action = elementMute;
          break;
        case 'power':
          var action = elementPower;
          break;
        case 'volumeup':
          var action = elementVolumeUp;
          break;
        case 'volumedown':
          var action = elementVolumeDown;
          break;
        case 'inputscroll':
          var action = elementInputScroll;
          break;
      }
      sendIR(connectorAddress, action, res)
    });

    router.route('/xboxone/:id/:command')
        .post(function(req, res) {
          switch(req.params.id) {
            case 'bottom':
              var connectorAddress = '4:2';
              break;
            case 'top':
              var connectorAddress = '4:1';
              break;
          }

          switch (req.params.command) {
            case 'back':
              var action = xboxBack;
              break;
            case 'channelup':
              var action = xboxChannelUp;
              break;
            case 'channeldown':
              var action = xboxChannelDown;
              break;
            case 'cursordown':
              var action = xboxCursorDown;
              break;
            case 'cursorenter':
              var action = xboxCursorEnter;
              break;
            case 'cursorleft':
              var action = xboxCursorLeft;
              break;
            case 'cursorright':
              var action = xboxCursorRight;
              break;
            case 'cursorup':
              var action = xboxCursorUp;
              break;
            case 'digit0':
              var action = xboxDigit0;
              break;
            case 'digit1':
              var action = xboxDigit1;
              break;
            case 'digit2':
              var action = xboxDigit2;
              break;
            case 'digit3':
              var action = xboxDigit3;
              break;
            case 'digit4':
              var action = xboxDigit4;
              break;
            case 'digit5':
              var action = xboxDigit5;
              break;
            case 'digit6':
              var action = xboxDigit6;
              break;
            case 'digit7':
              var action = xboxDigit7;
              break;
            case 'digit8':
              var action = xboxDigit8;
              break;
            case 'digit9':
              var action = xboxDigit9;
              break;
            case 'enter':
              var action = xboxEnter;
              break;
            case 'exit':
              var action = xboxExit;
              break;
            case 'forward':
              var action = xboxForward;
              break;
            case 'blue':
              var action = xboxFunctionBlue;
              break;
            case 'green':
              var action = xboxFunctionGreen;
              break;
            case 'red':
              var action = xboxFunctionRed;
              break;
            case 'yellow':
              var action = xboxFunctionYellow;
              break;
            case 'menuhome':
              var action = xboxMenuHome;
              break;
            case 'menumain':
              var action = xboxMenuMain;
              break;
            case 'mute':
              var action = xboxMuteToggle;
              break;
            case 'next':
              var action = xboxNext;
              break;
            case 'nexus':
              var action = xboxNexusXbox;
              break;
            case 'oneguide':
              var action = xboxOneGuide;
              break;
            case 'openclose':
              var action = xboxOpenClose;
              break;
            case 'pause':
              var action = xboxPause;
              break;
            case 'play':
              var action = xboxPlay;
              break;
            case 'playpause':
              var action = xboxPlayPauseToggle;
              break;
            case 'poweroff':
              var action = xboxPowerOff;
              break;
            case 'poweron':
              var action = xboxPowerOn;
              break;
            case 'power':
              var action = xboxPowerToggle;
              break;
            case 'previous':
              var action = xboxPrevious;
              break;
            case 'reverse':
              var action = xboxReverse;
              break;
            case 'stop':
              var action = xboxStop;
              break;
            case 'view':
              var action = xboxView;
              break;
            case 'volumeup':
              var action = xboxVolumeUp;
              break;
            case 'volumedown':
              var action = xboxVolumeDown;
              break;
          }
          sendIR(connectorAddress, action, res)
        });

// REGISTER OUR ROUTES -------------------------------
// all of our routes will be prefixed with /api
app.use('/api', router);

function sendIR(connectorAddress, action, res) {
  var client = new net.Socket();
  var command = 'sendir,' + connectorAddress + ',' + action + '\r'
  client.connect(GC_SERVER_PORT, GC_SERVER_HOST, function() {
      console.log('CONNECTED TO: ' + GC_SERVER_HOST + ':' + GC_SERVER_PORT);
      // Write a message to the socket as soon as the client is connected, the server will receive it as message from the client
      console.log('Sending: ' + command);
      client.write(command);
  });

  // Add a 'data' event handler for the client socket
  // data is what the server sent to this socket
  client.on('data', function(data) {
      console.log('Response: ' + data);
      res.send(data);
      // Close the client socket completely
      client.destroy();
  });

  // Add a 'close' event handler for the client socket
  client.on('close', function() {
      console.log('Connection closed');
  });
};

// START THE SERVER
// =============================================================================
app.listen(port);
console.log('Magic happens on port ' + port);
